<div class="account-setting-right">
    <h3>
  {{ addUserForm.get('userId')?.value > 0 ? 'Update User' : 'Add New User' }}
</h3>

   <p>
  {{ addUserForm.get('userId')?.value > 0 
      ? 'Please use the form below to update the user account.' 
      : 'Please use the form below to create a new user account.' }}
</p>
    <span></span>

    <form [formGroup]="addUserForm" (ngSubmit)="onAddUser()">
        <div class="row">

            <!-- First Name -->
            <div class="col-md-6">
                <div class="mb-3">
                    <label class="form-label fw-semibold">First Name</label>
                    <input type="text" class="form-control" placeholder="First Name" formControlName="firstName"
                        maxlength="50" />
                    <small class="error"
                        *ngIf="addUserForm.get('firstName')?.touched && addUserForm.get('firstName')?.hasError('required')">
                        First Name is required.
                    </small>
                </div>
            </div>

            <!-- Last Name -->
            <div class="col-md-6">
                <div class="mb-3">
                    <label class="form-label fw-semibold">Last Name</label>
                    <input type="text" class="form-control" placeholder="Last Name" formControlName="lastName"
                        maxlength="50" />
                    <small class="error"
                        *ngIf="addUserForm.get('lastName')?.touched && addUserForm.get('lastName')?.hasError('required')">
                        Last Name is required.
                    </small>
                </div>
            </div>

            <!-- Email -->
            <div class="col-md-6">
                <div class="mb-3">
                    <label class="form-label fw-semibold">Email Address</label>
                    <input type="email" class="form-control" placeholder="Email" formControlName="email"
                        maxlength="100" />
                    <small class="error"
                        *ngIf="addUserForm.get('email')?.touched && addUserForm.get('email')?.hasError('required')">
                        Email is required.
                    </small>
                    <small class="error" *ngIf="addUserForm.get('email')?.hasError('email')">
                        Enter a valid email address.
                    </small>
                </div>
            </div>

            <!-- Password -->
            <div class="col-md-6" >
                <div class="mb-3">
                    <label class="form-label fw-semibold">Password</label>
                    <input [type]="addUserForm.value.userId > 0 ? 'password' : 'text'" class="form-control" placeholder="Password" formControlName="password"
                        maxlength="50" />
                    <small class="error"
                        *ngIf="addUserForm.get('password')?.touched && addUserForm.get('password')?.hasError('required')">
                        Password is required.
                    </small>
                    <small class="error" *ngIf="addUserForm.get('password')?.hasError('minlength')">
                        Password must be at least 6 characters.
                    </small>
                </div>
            </div>

            <!-- Store ID -->
            <div class="col-md-6 position-relative" *ngIf="user?.StoreId=='0'">
                <div class="mb-3">
                    <label class="form-label fw-semibold">Select Store</label>

                    <!-- Searchable input -->
                    <input type="text" class="form-control" placeholder="Search store..." formControlName="storeName"
                        (input)="filterStores()" (focus)="onFocus() " (blur)="closeDropdown()" [readOnly]="userRoles.includes('IsAdmin')"/>
                    <!-- Dropdown list -->
                    <ul *ngIf="dropdownOpen && stores.length" class="list-group position-absolute w-100"
                        style="max-height: 200px; overflow-y: auto; z-index: 9999;">
                        <li class="list-group-item list-group-item-action" *ngFor="let store of stores"
                            (mousedown)="selectStore(store)">
                            {{ store.storeName }}
                        </li>
                    </ul>
                </div>
            </div>


            <!-- User Classification -->
            <div class="col-md-6" *ngIf="user?.StoreId=='0'">
                <div class="mb-3">
                    <label class="form-label fw-semibold">User Classification</label>
                    <select class="form-control" formControlName="userClassification" >
                        <option value="" disabled selected>Select User Classification</option>
                        <option value="Retailer" [disabled]="userRoles.includes('IsAdmin')">Retailer</option>
                        <option value="Distributor" [disabled]="userRoles.includes('IsAdmin')">Distributor</option>
                    </select>
                </div>
            </div>

            <div class="col-md-6" *ngIf="user?.StoreId=='0'">
                <div class="mb-3">
                    <label class="form-label fw-semibold">Type</label>
                    <select class="form-control" formControlName="type" >
                        <option value="" disabled selected>Select User Type</option>
                        <option value="GRE North" [disabled]="userRoles.includes('IsAdmin')">GRE North</option>
                        <option value="GRE South" [disabled]="userRoles.includes('IsAdmin')">GRE South</option>
                    </select>
                </div>
            </div>

            <!-- Toggles (Permissions & Roles) -->
            <div class="col-md-12">
                <h5 class="fw-semibold mt-3 mb-3">Permissions</h5>
                <div class="row">

                    <div class="col-md-6">
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" formControlName="canViewOrderHistory"
                                id="viewHistory">
                            <label class="form-check-label" for="viewHistory">Can View Order History</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" formControlName="canViewPromoOrderHistory"
                                id="promoViewHistory">
                            <label class="form-check-label" for="promoViewHistory">Can View Promo Order History</label>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" formControlName="canOrderSalesProducts"
                                id="orderSales">
                            <label class="form-check-label" for="orderSales">Can Order Sales Products</label>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" formControlName="canOrderPromoProducts"
                                id="orderPromo">
                            <label class="form-check-label" for="orderPromo">Can Order Promo Products</label>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" formControlName="mfaEnabled" id="mfa">
                            <label class="form-check-label" for="mfa">MFA Enabled</label>
                        </div>
                    </div>

                    <div class="col-md-6" *ngIf="user?.StoreId=='0'">
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" formControlName="isAdmin" id="admin" >
                            <label class="form-check-label" for="admin">Admin User</label>
                        </div>
                    </div>

                </div>
            </div>



            <!-- Submit -->
            <div class="col-md-12">
                <button type="submit" class="common-btn mt-4 border-0">
                    <img src="assets/images/orange-arrow-right.png" alt="Arrow Right" class="img-fluid" />
                    <p class="text-white m-0">  {{ addUserForm.get('userId')?.value > 0 
      ? 'Update User' 
      : 'Create User' }}</p>
                </button>
            </div>
        </div>
    </form>
</div>