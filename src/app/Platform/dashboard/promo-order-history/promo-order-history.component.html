<section class="tobacco-order">
    <div class="container">
        <div class="order-history-header">
            @if(user?.StoreId=='0'){
            <div class="order-history-left">
                <h2>Promo Order Received</h2>
                <p>Click on order to view details.</p>
            </div>
            }
            @else {
            <div class="order-history-left">
                <h2>Promo Order History</h2>
                <p>Click on order to view details.</p>
            </div>
            }
            <div class="order-history-right">
                <p>Select date Range:</p>
                <input type="date" [(ngModel)]="filterModel.fromDate" [max]="today" class="form-control" />

                <input type="date" [(ngModel)]="filterModel.toDate" [max]="today" class="form-control" />

                <button matTooltipPosition="above" mat-raised-button matTooltip="Fetch History" class="order-arrow-right" (click)="getOrderHistory()"><img src="assets/images/angle-right.svg"
                        alt="Angle Right"></button>
                <button matTooltipPosition="above" mat-raised-button matTooltip="Reset Filter" class="order-reset-btn" (click)="resetFilter()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="#FFFFFF" fill-opacity="1" height="20px" width="20px"
                        viewBox="0 0 512 512">
                        <g>
                            <g>
                                <path d="M511.957,185.214L512,15.045l-67.587,67.587l-7.574-7.574
          c-48.332-48.332-112.593-74.95-180.946-74.95
          C114.792,0.107,0,114.901,0,256s114.792,255.893,255.893,255.893
          S511.785,397.099,511.785,256h-49.528
          c0,113.79-92.575,206.365-206.365,206.365S49.528,369.79,49.528,256
          S142.103,49.635,255.893,49.635
          c55.124,0,106.947,21.467,145.925,60.445l7.574,7.574l-67.58,67.58
          L511.957,185.214z" />
                            </g>
                        </g>
                    </svg>
                </button>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-bordered m-0">
                <thead>
                    <tr>
                        <th width="20%">Date</th>
                        @if(user?.StoreId=='0'){
                        <th width="30%">Store Name</th>
                        }

                        <th width="20%" class="text-start">Submitted By</th>
                        <th width="40%" class="text-start">Status</th>
                        <th width="15%"># of Products </th>
                        <th width="15%">Order Total</th>
                        
                        <th width="30%">Actions</th>
                        
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let order of orderHistory.orders">
                        <td>{{order.date | date:'YYYY-MM-dd'}}</td>
                        @if(user?.StoreId=='0'){
                        <td width="30%">{{order?.storeName}}</td>
                        }
                        <td class="text-start">{{order.submittedBy}}</td>
                        @if(user?.StoreId=='0'){
                        <td width="40%">
                            <div class="mb-3">
                                <!-- <label class="form-label fw-semibold">Type</label> -->
                                <select class="form-control" [(ngModel)]="order.statusId"
                                    (change)="onStatusChange(order)">
                                    <!-- <option value="" disabled selected>Select User Type</option> -->

                                    <option *ngFor="let status of orderHistory.orderStatus" [value]="status.statusId">
                                        {{status.statusName|titlecase}}
                                    </option>

                                </select>
                            </div>
                        </td>
                        }
                        @else {


                        <td width="40%" class="text-start">{{order.statusName|titlecase}}</td>
                        }
                        <td>{{order.numberOfProducts}}</td>
                        <td>{{order.totalPrice | currency:'USD'}}</td>
                       
                        <td>
                            <button class="btn btn-sm view-btn" (click)="fetchOrderDetails(order)">
                                View Order Details
                            </button>
                        </td>
                        
                    </tr>

                </tbody>
            </table>
        </div>
    </div>
</section>


<div class="modal fade" id="orderDetailsModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable  modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalLabel">Order Details - ID: {{ selectedOrderId }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <table class="table table-bordered table-sm">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Product Quantity</th>
                            <th>Product Price</th>
                            <th>Option</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of orderDetails">
                            <td>{{ item.productName }}</td>
                            <td>{{ item.productQuantity }}</td>
                            <td>{{ item.productPrice  | currency }}</td>
                            <td>{{item.sizeName}}</td>
                            <td>{{ item.subtotal | currency}}</td>
                           
                        </tr>
                    </tbody>
                </table>
                <div class="text-end fw-bold mt-2">
                    Total Price: {{ totalOrderPrice | currency }}
                </div>
            </div>
        </div>
    </div>
</div>