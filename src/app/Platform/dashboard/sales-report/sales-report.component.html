<section class="tobacco-order py-4 mt-5">
  <div class="container mt-5">

    <!-- Page Header -->
    <div class="mb-4 mt-5">
      <h2 class="fw-bold">Sales Report</h2>
    </div>

    <div>
      <select class="form-select form-select-sm w-50" (change)="onSelectChange($event)">
        <!-- <option selected>Report Type</option> -->
        <option value="1" selected>Sales by Territory, broken down by product</option>
        <option value="3">Sales by Territory, broken down by store</option>
        <option value="2">Product Sales by Territory(%)</option>
      </select>
    </div>



    <!-- Filters Row -->
    <div *ngIf="selectedReport == 1">

      <div class="row mb-3 g-3 align-items-end">

        <!-- Territory Search -->
        <div class="col-md-2 position-relative">
          <!-- <label class="form-label fw-semibold">Territories</label> -->

          <!-- <input type="text" class="form-control" placeholder="Select territory..." [(ngModel)]="searchTerritoryTerm"
            (input)="filterTerritories()" (focus)="dropdownOpen = true" (blur)="closeDropdown()">

          <ul *ngIf="dropdownOpen && territoriesList.length" class="list-group position-absolute w-100"
            style="max-height: 200px; overflow-y: auto; z-index: 1000;" (mousedown)="$event.preventDefault()">

            <li class="list-group-item d-flex align-items-center" *ngFor="let territory of territoriesList">

              <input type="checkbox" class="form-check-input me-2" [checked]="isTerritorySelected(territory)"
                (change)="toggleTerritory(territory)">

              {{ territory.territoryName }}

            </li>

          </ul> -->

          <input type="text" class="form-control" placeholder="Select territory..." [(ngModel)]="searchTerritoryTerm"
            (input)="filterTerritories()" (focus)="dropdownOpen = true" (blur)="closeDropdown()">

          <ul *ngIf="dropdownOpen && territoriesList.length" class="list-group position-absolute w-100"
            style="max-height: 200px; overflow-y: auto; z-index: 1000;" (mousedown)="$event.preventDefault()">

            <li class="list-group-item d-flex align-items-center" *ngFor="let territory of territoriesList"
              (click)="toggleTerritory(territory)">
          
              <input type="checkbox" class="form-check-input me-2" [checked]="isTerritorySelected(territory)"
                (click)="$event.stopPropagation()">

              {{ territory.territoryName }}

            </li>

          </ul>

        </div>





        <div class="col-md-2 position-relative">
          <!-- <label class="form-label fw-semibold">Product</label> -->

          <!-- <input type="text" class="form-control" placeholder="Search product..." [(ngModel)]="searchProductTerm"
            (input)="filterproduct()" (focus)="dropdownProductOpen = true" (blur)="closeProductDropdown()">

          <ul *ngIf="dropdownProductOpen && productList.length" class="list-group position-absolute w-100"
            style="max-height: 200px; overflow-y: auto; z-index: 1000;" (mousedown)="$event.preventDefault()">

            <li class="list-group-item d-flex align-items-center" *ngFor="let product of productList">

              <input type="checkbox" class="form-check-input me-2" [checked]="isProductSelected(product)"
                (change)="toggleProduct(product)">

              {{ product.productName }}

            </li>

          </ul> -->
          <input type="text" class="form-control" placeholder="Search product..." [(ngModel)]="searchProductTerm"
            (input)="filterproduct()" (focus)="dropdownProductOpen = true" (blur)="closeProductDropdown()">

          <ul *ngIf="dropdownProductOpen && productList.length" class="list-group position-absolute w-100"
            style="max-height: 200px; overflow-y: auto; z-index: 1000;" (mousedown)="$event.preventDefault()">

            <li class="list-group-item d-flex align-items-center" *ngFor="let product of productList"
              (click)="toggleProduct(product)">

              <input type="checkbox" class="form-check-input me-2" [checked]="isProductSelected(product)"
                (click)="$event.stopPropagation()">

              {{ product.productName }}

            </li>

          </ul>
        </div>
        <!-- Store & Product Filters -->
        <div class="col-md-2 position-relative">
          <!-- <label class="form-label fw-semibold">Store</label>

          <input type="text" class="form-control" placeholder="Search store..." [(ngModel)]="searchStoreTerm"
            (input)="filterStores()" (focus)="dropdownStoreOpen = true" (blur)="closeStoreDropdown()">

          <ul *ngIf="dropdownStoreOpen && storeList.length" class="list-group position-absolute w-100"
            style="max-height: 200px; overflow-y: auto; z-index: 1000;" (mousedown)="$event.preventDefault()">

            <li class="list-group-item d-flex align-items-center" *ngFor="let store of storeList">

              <input type="checkbox" class="form-check-input me-2" [checked]="isStoreSelected(store)"
                (change)="toggleStore(store)">

              {{ store.storeName }}

            </li>

          </ul> -->

        </div>

        <!-- Date Range -->
        <div class="col-md-4 d-flex flex-wrap gap-2 align-items-center">
          <div class="d-flex flex-column">
            <label class="form-label fw-semibold mb-1">From Date</label>
            <input type="date" class="form-control" [(ngModel)]="filterModel.FromDate" [max]="today"
              (input)="dateChange()">
          </div>
          <div class="d-flex flex-column">
            <label class="form-label fw-semibold mb-1">To Date</label>
            <input type="date" class="form-control" [(ngModel)]="filterModel.ToDate" [max]="today"
              (input)="dateChange()">
          </div>
          <div class="position-relative">
            <button matTooltipPosition="above" mat-raised-button matTooltip="Reset Filter"  class="order-reset-btn position-absolute bottom-1 start-0 p-2 " (click)="resetFilter()">
              <svg xmlns="http://www.w3.org/2000/svg" fill="#FFFFFF" fill-opacity="1" height="20px" width="20px"
                viewBox="0 0 512 512">
                <g>
                  <g>
                    <path d="M511.957,185.214L512,15.045l-67.587,67.587l-7.574-7.574
             c-48.332-48.332-112.593-74.95-180.946-74.95
             C114.792,0.107,0,114.901,0,256s114.792,255.893,255.893,255.893
             S511.785,397.099,511.785,256h-49.528
             c0,113.79-92.575,206.365-206.365,206.365S49.528,369.79,49.528,256
             S142.103,49.635,255.893,49.635
             c55.124,0,106.947,21.467,145.925,60.445l7.574,7.574l-67.58,67.58
             L511.957,185.214z" />
                  </g>
                </g>
              </svg>
            </button>
          </div>

        </div>
        <div class="col-md-2 mb-3 position-relative">

          <div class="d-flex justify-content-end mb-3">
            <button class="btn btn-style" (click)="downloadExcel()">
              <i class="bi bi-file-earmark-excel-fill"></i> Download Excel
            </button>
          </div>
        </div>

      </div>

 <!-- <div class="mb-2 fw-bold">
        <p>{{dateRange}}</p>
      </div> -->
      <!-- Sales Table -->
      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle text-center">
          <thead class="table-light">
            <tr>
              <th class="text-center">Territory</th>
              <!-- <th class="text-center">Store</th> -->
              <th class="text-center">Product</th>
              <th class="text-center">Cartons</th>
              <th class="text-center">Cases</th>
              <th class="text-center">Total Sales</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let record of salesRecordsList">
              <td class="text-start">{{ record.territoryName }}</td>
              <!-- <td class="text-start">{{ record.storeName }}</td> -->
              <td class="text-start">{{ record.productName }}</td>
              <td class="text-start">{{ record.cartons }}</td>
              <td class="text-start">{{ record.cases }}</td>
              <td class="text-start">{{ record.totalSales | currency }}</td>
            </tr>
          </tbody>
        </table>
        <div class="pagination-wrapper mt-3">
          <app-pagination [totalItems]="totalRecords" [itemsPerPage]="pageSize" [currentPage]="page"
            (pageChanged)="onPageChanged($event)" (pageSizeChanged)="onPageSizeChange($event)"></app-pagination>
        </div>

      </div>
    </div>

    <div *ngIf="selectedReport==2">
      <div class="row mb-3 g-3 align-items-end">

        <!-- Territory Search -->
        <div class="col-md-2 position-relative">
          <!-- <label class="form-label fw-semibold">Territorys</label>
          <input type="text" class="form-control" placeholder="Search territory..." [(ngModel)]="searchTerritoryTerm"
            (input)="filterTerritories()" (focus)="dropdownOpen = true" (blur)="closeDropdown()">

          <ul *ngIf="dropdownOpen && territoriesList.length" class="list-group position-absolute w-100"
            style="max-height: 200px; overflow-y: auto; z-index: 1000;">
            <li class="list-group-item list-group-item-action" *ngFor="let territory of territoriesList"
              (mousedown)="selectTerritory(territory)">
              {{ territory.territoryName }}
            </li>
          </ul> -->

          <!-- <label class="form-label fw-semibold">Territories</label> -->

          <!-- <input type="text" class="form-control" placeholder="Select territory..." [(ngModel)]="searchTerritoryTerm"
            (input)="filterTerritories()" (focus)="dropdownOpen = true" (blur)="closeDropdown()">

          <ul *ngIf="dropdownOpen && territoriesList.length" class="list-group position-absolute w-100"
            style="max-height: 200px; overflow-y: auto; z-index: 1000;" (mousedown)="$event.preventDefault()">

            <li class="list-group-item d-flex align-items-center" *ngFor="let territory of territoriesList">

              <input type="checkbox" class="form-check-input me-2" [checked]="isTerritorySelected(territory)"
                (change)="toggleTerritory(territory)">

              {{ territory.territoryName }}

            </li>

          </ul> -->
 <input type="text" class="form-control" placeholder="Select territory..." [(ngModel)]="searchTerritoryTerm"
            (input)="filterTerritories()" (focus)="dropdownOpen = true" (blur)="closeDropdown()">

          <ul *ngIf="dropdownOpen && territoriesList.length" class="list-group position-absolute w-100"
            style="max-height: 200px; overflow-y: auto; z-index: 1000;" (mousedown)="$event.preventDefault()">

            <li class="list-group-item d-flex align-items-center" *ngFor="let territory of territoriesList"
              (click)="toggleTerritory(territory)">

              <input type="checkbox" class="form-check-input me-2" [checked]="isTerritorySelected(territory)"
                (click)="$event.stopPropagation()">

              {{ territory.territoryName }}

            </li>

          </ul>
        </div>


        <div class="col-md-2 position-relative">
          <!-- <label class="form-label fw-semibold">Product</label>
          <input type="text" class="form-control" placeholder="Search product..." [(ngModel)]="searchProductTerm"
            (input)="filterproduct()" (focus)="dropdownProductOpen = true" (blur)="closeProductDropdown()">

          <ul *ngIf="dropdownProductOpen && productList.length" class="list-group position-absolute w-100"
            style="max-height: 200px; overflow-y: auto; z-index: 1000;">
            <li class="list-group-item list-group-item-action" *ngFor="let product of productList"
              (mousedown)="selectProduct(product)">
              {{ product.productName }}
            </li>
          </ul> -->
          <!-- <label class="form-label fw-semibold">Product</label> -->

          <!-- <input type="text" class="form-control" placeholder="Search product..." [(ngModel)]="searchProductTerm"
            (input)="filterproduct()" (focus)="dropdownProductOpen = true" (blur)="closeProductDropdown()">

          <ul *ngIf="dropdownProductOpen && productList.length" class="list-group position-absolute w-100"
            style="max-height: 200px; overflow-y: auto; z-index: 1000;" (mousedown)="$event.preventDefault()">

            <li class="list-group-item d-flex align-items-center" *ngFor="let product of productList">

              <input type="checkbox" class="form-check-input me-2" [checked]="isProductSelected(product)"
                (change)="toggleProduct(product)">

              {{ product.productName }}

            </li>

          </ul> -->
          <input type="text" class="form-control" placeholder="Search product..." [(ngModel)]="searchProductTerm"
       (input)="filterproduct()" (focus)="dropdownProductOpen = true" (blur)="closeProductDropdown()">

<ul *ngIf="dropdownProductOpen && productList.length" class="list-group position-absolute w-100"
    style="max-height: 200px; overflow-y: auto; z-index: 1000;" (mousedown)="$event.preventDefault()">

  <li class="list-group-item d-flex align-items-center"
      *ngFor="let product of productList"
      (click)="toggleProduct(product)">
    
    <input type="checkbox" class="form-check-input me-2"
           [checked]="isProductSelected(product)"
           (click)="$event.stopPropagation()">

    {{ product.productName }}

  </li>

</ul>

        </div>

        <!-- Store & Product Filters -->
        <div class="col-md-2 position-relative">
          <!-- <label class="form-label fw-semibold">Store</label>
          <input type="text" class="form-control" placeholder="Search store..." [(ngModel)]="searchStoreTerm"
            (input)="filterStores()" (focus)="dropdownStoreOpen = true" (blur)="closeStoreDropdown()">

          <ul *ngIf="dropdownStoreOpen && storeList.length" class="list-group position-absolute w-100"
            style="max-height: 200px; overflow-y: auto; z-index: 1000;">
            <li class="list-group-item list-group-item-action" *ngFor="let store of storeList"
              (mousedown)="selectStore(store)">
              {{ store.storeName }}
            </li>
          </ul> -->
        </div>


        <!-- Date Range -->
        <div class="col-md-4 d-flex flex-wrap gap-2 align-items-center">
          <div class="d-flex flex-column">
            <label class="form-label fw-semibold mb-1">From Date</label>
            <input type="date" class="form-control" [(ngModel)]="filterModel.FromDate" [max]="today"
              (input)="dateChange()">
          </div>
          <div class="d-flex flex-column">
            <label class="form-label fw-semibold mb-1">To Date</label>
            <input type="date" class="form-control" [(ngModel)]="filterModel.ToDate" [max]="today"
              (input)="dateChange()">
          </div>
          <div class="position-relative">
            <button class="order-reset-btn position-absolute bottom-1 start-0 p-2 " matTooltipPosition="above" mat-raised-button matTooltip="Reset Filter" (click)="resetFilter()">
              <svg xmlns="http://www.w3.org/2000/svg" fill="#FFFFFF" fill-opacity="1" height="20px" width="20px"
                viewBox="0 0 512 512">
                <g>
                  <g>
                    <path d="M511.957,185.214L512,15.045l-67.587,67.587l-7.574-7.574
             c-48.332-48.332-112.593-74.95-180.946-74.95
             C114.792,0.107,0,114.901,0,256s114.792,255.893,255.893,255.893
             S511.785,397.099,511.785,256h-49.528
             c0,113.79-92.575,206.365-206.365,206.365S49.528,369.79,49.528,256
             S142.103,49.635,255.893,49.635
             c55.124,0,106.947,21.467,145.925,60.445l7.574,7.574l-67.58,67.58
             L511.957,185.214z" />
                  </g>
                </g>
              </svg>
            </button>
          </div>

        </div>
        <div class="col-md-2 mb-3 position-relative">

          <div class="d-flex justify-content-end mb-3">
            <button class="btn btn-style" (click)="downloadExcel()">
              <i class="bi bi-file-earmark-excel-fill"></i> Download Excel
            </button>
          </div>
        </div>

      </div>

      <!-- <div class="mb-2 fw-bold">
        <p>{{dateRange}}</p>
      </div> -->
      <!-- Sales Table -->
      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle text-center">
          <thead class="table-light">
            <tr>
              <th class="text-center">Territory</th>
              <th class="text-center">Product</th>
              <th class="text-center">Sales</th>
              <th class="text-center">Total Sales</th>
              <th class="text-center">Sales Percentage</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let record of salesRecordsList">
              <td class="text-start">{{ record.territoryName }}</td>
              <td class="text-start">{{ record.productName }}</td>
              <td class="text-start">{{ record.totalSales| currency }}</td>
              <td class="text-start">{{ record.globalTotal| currency}}</td>
              <td class="text-start">{{ record.salesPercentage}}%</td>
              <!-- <td class="text-start">{{ record.totalSales | currency }}</td> -->
            </tr>
          </tbody>
        </table>

        <app-pagination [totalItems]="totalRecords" [itemsPerPage]="pageSize" [currentPage]="page"
          (pageChanged)="onPageChanged($event)" (pageSizeChanged)="onPageSizeChange($event)"></app-pagination>
      </div>

    </div>

    <div *ngIf="selectedReport == 3">

      <div class="row mb-3 g-3 align-items-end">

        <!-- Territory Search -->
        <div class="col-md-2 position-relative">
          <!-- <label class="form-label fw-semibold">Territories</label> -->

          <!-- <input type="text" class="form-control" placeholder="Select territory..." [(ngModel)]="searchTerritoryTerm"
            (input)="filterTerritories()" (focus)="dropdownOpen = true" (blur)="closeDropdown()">

          <ul *ngIf="dropdownOpen && territoriesList.length" class="list-group position-absolute w-100"
            style="max-height: 200px; overflow-y: auto; z-index: 1000;" (mousedown)="$event.preventDefault()">

            <li class="list-group-item d-flex align-items-center" *ngFor="let territory of territoriesList">

              <input type="checkbox" class="form-check-input me-2" [checked]="isTerritorySelected(territory)"
                (change)="toggleTerritory(territory)">

              {{ territory.territoryName }}

            </li>

          </ul> -->

          <input type="text" class="form-control" placeholder="Select territory..." [(ngModel)]="searchTerritoryTerm"
            (input)="filterTerritories()" (focus)="dropdownOpen = true" (blur)="closeDropdown()">

          <ul *ngIf="dropdownOpen && territoriesList.length" class="list-group position-absolute w-100"
            style="max-height: 200px; overflow-y: auto; z-index: 1000;" (mousedown)="$event.preventDefault()">

            <li class="list-group-item d-flex align-items-center" *ngFor="let territory of territoriesList"
              (click)="toggleTerritory(territory)">

              <input type="checkbox" class="form-check-input me-2" [checked]="isTerritorySelected(territory)"
                (click)="$event.stopPropagation()">

              {{ territory.territoryName }}

            </li>

          </ul>

        </div>





        <div class="col-md-2 position-relative">
          <!-- <label class="form-label fw-semibold">Product</label> -->

          <!-- <input type="text" class="form-control" placeholder="Search product..." [(ngModel)]="searchProductTerm"
            (input)="filterproduct()" (focus)="dropdownProductOpen = true" (blur)="closeProductDropdown()">

          <ul *ngIf="dropdownProductOpen && productList.length" class="list-group position-absolute w-100"
            style="max-height: 200px; overflow-y: auto; z-index: 1000;" (mousedown)="$event.preventDefault()">

            <li class="list-group-item d-flex align-items-center" *ngFor="let product of productList">

              <input type="checkbox" class="form-check-input me-2" [checked]="isProductSelected(product)"
                (change)="toggleProduct(product)">

              {{ product.productName }}

            </li>

          </ul> -->
          <!-- <input type="text" class="form-control" placeholder="Search product..." [(ngModel)]="searchProductTerm"
            (input)="filterproduct()" (focus)="dropdownProductOpen = true" (blur)="closeProductDropdown()">

          <ul *ngIf="dropdownProductOpen && productList.length" class="list-group position-absolute w-100"
            style="max-height: 200px; overflow-y: auto; z-index: 1000;" (mousedown)="$event.preventDefault()">

            <li class="list-group-item d-flex align-items-center" *ngFor="let product of productList"
              (click)="toggleProduct(product)">

              <input type="checkbox" class="form-check-input me-2" [checked]="isProductSelected(product)"
                (click)="$event.stopPropagation()">

              {{ product.productName }}

            </li>

          </ul> -->
        </div>
        <!-- Store & Product Filters -->
        <div class="col-md-2 position-relative">
          <!-- <label class="form-label fw-semibold">Store</label>

          <input type="text" class="form-control" placeholder="Search store..." [(ngModel)]="searchStoreTerm"
            (input)="filterStores()" (focus)="dropdownStoreOpen = true" (blur)="closeStoreDropdown()">

          <ul *ngIf="dropdownStoreOpen && storeList.length" class="list-group position-absolute w-100"
            style="max-height: 200px; overflow-y: auto; z-index: 1000;" (mousedown)="$event.preventDefault()">

            <li class="list-group-item d-flex align-items-center" *ngFor="let store of storeList">

              <input type="checkbox" class="form-check-input me-2" [checked]="isStoreSelected(store)"
                (change)="toggleStore(store)">

              {{ store.storeName }}

            </li>

          </ul> -->

        </div>

        <!-- Date Range -->
        <div class="col-md-4 d-flex flex-wrap gap-2 align-items-center">
          <div class="d-flex flex-column">
            <label class="form-label fw-semibold mb-1">From Date</label>
            <input type="date" class="form-control" [(ngModel)]="filterModel.FromDate" [max]="today"
              (input)="dateChange()">
          </div>
          <div class="d-flex flex-column">
            <label class="form-label fw-semibold mb-1">To Date</label>
            <input type="date" class="form-control" [(ngModel)]="filterModel.ToDate" [max]="today"
              (input)="dateChange()">
          </div>
          <div class="position-relative">
            <button class="order-reset-btn position-absolute bottom-1 start-0 p-2 "  matTooltipPosition="above" mat-raised-button matTooltip="Reset Filter" (click)="resetFilter()">
              <svg xmlns="http://www.w3.org/2000/svg" fill="#FFFFFF" fill-opacity="1" height="20px" width="20px"
                viewBox="0 0 512 512">
                <g>
                  <g>
                    <path d="M511.957,185.214L512,15.045l-67.587,67.587l-7.574-7.574
             c-48.332-48.332-112.593-74.95-180.946-74.95
             C114.792,0.107,0,114.901,0,256s114.792,255.893,255.893,255.893
             S511.785,397.099,511.785,256h-49.528
             c0,113.79-92.575,206.365-206.365,206.365S49.528,369.79,49.528,256
             S142.103,49.635,255.893,49.635
             c55.124,0,106.947,21.467,145.925,60.445l7.574,7.574l-67.58,67.58
             L511.957,185.214z" />
                  </g>
                </g>
              </svg>
            </button>
          </div>

        </div>
        <div class="col-md-2 mb-3 position-relative">

          <div class="d-flex justify-content-end mb-3">
            <button class="btn btn-style" (click)="downloadExcel()">
              <i class="bi bi-file-earmark-excel-fill"></i> Download Excel
            </button>
          </div>
        </div>

      </div>

 <!-- <div class="mb-2 fw-bold">
        <p>{{dateRange}}</p>
      </div> -->
      <!-- Sales Table -->
      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle text-center">
          <thead class="table-light">
            <tr>
              <th class="text-center">Territory</th>
              <th class="text-center">Store</th>
              <!-- <th class="text-center">Product</th> -->
              <!-- <th class="text-center">Cartons</th>
              <th class="text-center">Cases</th> -->
              <th class="text-center">Total Sales</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let record of salesRecordsList">
              <td class="text-start">{{ record.territoryName }}</td>
              <td class="text-start">{{ record.storeName }}</td>
              <!-- <td class="text-start">{{ record.productName }}</td> -->
              <!-- <td class="text-start">{{ record.cartons }}</td>
              <td class="text-start">{{ record.cases }}</td> -->
              <td class="text-start">{{ record.totalSales | currency }}</td>
            </tr>
          </tbody>
        </table>
        <div class="pagination-wrapper mt-3">
          <app-pagination [totalItems]="totalRecords" [itemsPerPage]="pageSize" [currentPage]="page"
            (pageChanged)="onPageChanged($event)" (pageSizeChanged)="onPageSizeChange($event)"></app-pagination>
        </div>

      </div>
    </div>
  </div>
</section>